<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinControl AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo">
                <img src="{{ url_for('static', filename='img/money-bag.png') }}" alt="FinControl AI Logo">
            </div>
            <nav>
                <ul>
                    <li class="active"><a href="#"><img src="{{ url_for('static', filename='img/home.png') }}" alt="Home"></a></li>
                    <li><a href="#"><img src="{{ url_for('static', filename='img/graph.png') }}" alt="RelatÃ³rios"></a></li>
                    <li><a href="#"><img src="{{ url_for('static', filename='img/wallet.png') }}" alt="Carteira"></a></li>
                    <li><a href="#"><img src="{{ url_for('static', filename='img/settings.png') }}" alt="ConfiguraÃ§Ãµes"></a></li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <header>
                <div class="header-text">
                    <h1>Bom dia, JoÃ£o! ðŸ‘‹</h1>
                    <p>Veja o resumo das suas finanÃ§as hoje.</p>
                </div>
                <div class="header-actions">
                    <button class="date-picker">ðŸ“… Outubro 2023</button>
                    <button class="new-transaction">+ Nova TransaÃ§Ã£o</button>
                </div>
            </header>
            <section class="cards-section">
                <div class="card">
                    <div class="card-icon saldo"><img src="{{ url_for('static', filename='img/saldo.png') }}" alt="Saldo"></div>
                    <div class="card-info">
                        <span>SALDO ATUAL</span>
                        <h2>R$ {{ "%.2f"|format(dados.saldo) }}</h2>
                        <p class="positive">â†‘ 12% vs mÃªs pass.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon gasto"><img src="{{ url_for('static', filename='img/gasto.png') }}" alt="Gasto"></div>
                    <div class="card-info">
                        <span>GASTO NA SEMANA</span>
                        <h2>R$ {{ "%.2f"|format(dados.gasto_semana) }}</h2>
                        <p class="negative">â†“ R$ 250 extra</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon meta"><img src="{{ url_for('static', filename='img/meta.png') }}" alt="Meta"></div>
                    <div class="card-info">
                        <span>META DE ECONOMIA</span>
                        <h2>R$ {{ "%.2f"|format(dados.meta_economia) }}</h2>
                        <p class="positive">â†‘ 82% concluÃ­do</p>
                    </div>
                </div>
            </section>
            <section class="main-dashboard">
                <div class="chart-container">
                    <h3>Gastos da Semana</h3>
                    <div id="weekly-chart"></div>
                </div>
                <div class="insights-container">
                    <h3><img src="{{ url_for('static', filename='img/insights.png') }}" alt="Insights"> Insights Inteligentes (AI)</h3>
                    <div class="insight alert">
                        <h4><img src="{{ url_for('static', filename='img/alert.png') }}" alt="Alerta"> ALERTA</h4>
                        <p><strong>Ajuste o Fluxo de Caixa</strong><br>
                        Seu gasto semanal de R$ 1.850,40 projeta uma despesa mensal de R$ 7.401,60, o que excede sua renda de R$ 6.300. Reduza gastos variÃ¡veis imediatamente para nÃ£o comprometer sua meta de R$ 2.000.</p>
                    </div>
                    <div class="insight tip">
                        <h4><img src="{{ url_for('static', filename='img/idea.png') }}" alt="Dica"> DICA</h4>
                        <p><strong>Controle AlimentaÃ§Ã£o Fora</strong><br>
                        Gastos com restaurante japonÃªs e supermercado somaram R$ 630,50 em poucos dias. Priorize refeiÃ§Ãµes em casa nesta semana para garantir que o excedente da sua renda freelance ajude a bater sua meta.</p>
                    </div>
                </div>
            </section>
            <section class="activity-section">
                <h3>Ãšltimas Atividades</h3>
                <a href="#" class="view-all">Ver tudo</a>
                <ul>
                    {% for item in dados.historico %}
                    <li>{{ item.descricao }} <span>{{ item.valor }}</span></li>
                    {% endfor %}
                </ul>
            </section>
        </main>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('/api/dados')
                .then(response => response.json())
                .then(data => {
                    const chartData = data.gastos_da_semana_chart;
                    const options = {
                        series: [{
                            name: 'Gastos',
                            data: chartData.map(item => item.valor)
                        }],
                        chart: {
                            type: 'bar',
                            height: 350,
                            toolbar: {
                                show: false
                            }
                        },
                        plotOptions: {
                            bar: {
                                horizontal: false,
                                columnWidth: '55%',
                                endingShape: 'rounded'
                            },
                        },
                        dataLabels: {
                            enabled: false
                        },
                        stroke: {
                            show: true,
                            width: 2,
                            colors: ['transparent']
                        },
                        xaxis: {
                            categories: chartData.map(item => item.dia),
                        },
                        yaxis: {
                            title: {
                                text: 'R$'
                            }
                        },
                        fill: {
                            opacity: 1,
                            colors: ['#8b5cf6']
                        },
                        tooltip: {
                            y: {
                                formatter: function (val) {
                                    return "R$ " + val
                                }
                            }
                        }
                    };

                    const chart = new ApexCharts(document.querySelector("#weekly-chart"), options);
                    chart.render();
                });
        });
    </script>
</body>
</html>
